version: "3"

tasks:
  format:
    desc: Format and auto-fix code
    aliases: [fmt]
    cmds:
      - golangci-lint run --fix ./...

  lint:
    desc: Run linters (no fixes)
    cmds:
      - golangci-lint run ./...

  test:
    desc: Run tests
    cmds:
      - go test ./...

  test:race:
    desc: Run tests with race detector
    cmds:
      - go test -race -count=1 ./...

  build:
    desc: Build all packages
    cmds:
      - go build ./...

  examples:
    desc: Build and run examples
    cmds:
      - go run ./examples/default_layout
      - go run ./examples/hive_layout
      - go run ./examples/blob_upload
      - go run ./examples/manifest_driven

  s3:up:
    desc: Start S3-compatible test services (LocalStack + MinIO)
    cmds:
      - docker compose -f internal/s3/docker-compose.yaml up -d

  s3:down:
    desc: Stop S3-compatible test services
    cmds:
      - docker compose -f internal/s3/docker-compose.yaml down

  s3:test:
    desc: Run S3 integration tests (requires s3:up first)
    env:
      LODE_S3_TESTS: "1"
    cmds:
      - go test -v -tags=integration ./internal/s3/...
